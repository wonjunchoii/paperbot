<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperBot - Pro Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #0b0f1a; color: #e2e8f0; }
        .sidebar-bg { background-color: #111827; }
        .card-bg { background-color: #1e293b; }
        .accent-blue { color: #3b82f6; }
        .ai-popup { 
            display: none; 
            position: fixed; 
            bottom: 80px; 
            right: 30px; 
            width: 380px; 
            height: 500px; 
            background: #1e293b;
            border: 1px solid #334155;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            z-index: 50;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        @keyframes chipIn {
            from { opacity: 0; transform: scale(0.85) translateY(2px); }
            to   { opacity: 1; transform: scale(1) translateY(0); }
        }
        #chipContainer > div { transition: transform 0.15s ease, opacity 0.15s ease; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-72 sidebar-bg border-r border-slate-800 flex flex-col">
        <div class="p-6 font-bold text-2xl accent-blue tracking-tight">PaperBot</div>

        <!-- Action Buttons -->
        <div class="px-4 flex gap-2 mb-4">
            <button id="btnFetch" class="flex-1 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-500 text-white text-xs font-semibold py-2.5 rounded-lg transition-all active:scale-95">
                <i class="fa-solid fa-download text-[11px]"></i> Fetch Papers
            </button>
            <div class="relative">
                <button id="btnExport" class="flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-semibold px-4 py-2.5 rounded-lg border border-slate-700 transition-all active:scale-95">
                    <i class="fa-solid fa-file-export text-[11px]"></i> Export <i class="fa-solid fa-chevron-down text-[8px] ml-0.5 text-slate-500"></i>
                </button>
                <div id="exportDropdown" class="hidden absolute top-full right-0 mt-1 w-52 bg-slate-800 border border-slate-700 rounded-xl shadow-xl shadow-black/40 z-50 overflow-hidden">

                    <!-- Section: Picked → Read -->
                    <div class="px-3 pt-2.5 pb-1">
                        <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Picked → Read</span>
                    </div>
                    <button class="export-option flex items-center gap-2.5 w-full px-3 py-2 text-xs text-slate-300 hover:bg-blue-600/10 hover:text-blue-300 transition-colors" data-action="promote" data-format="none">
                        <i class="fa-solid fa-arrow-right text-[10px] text-violet-400 w-4 text-center"></i> Mark as Read
                    </button>

                    <!-- Divider -->
                    <div class="mx-3 my-1.5 border-t border-slate-700/60"></div>

                    <!-- Section: Read Library -->
                    <div class="px-3 pt-1 pb-1">
                        <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">Read Library</span>
                    </div>
                    <button class="export-option flex items-center gap-2.5 w-full px-3 py-2 text-xs text-slate-300 hover:bg-emerald-600/10 hover:text-emerald-300 transition-colors" data-action="export-read" data-format="bib">
                        <i class="fa-solid fa-book text-[10px] text-blue-400 w-4 text-center"></i> BibTeX (.bib)
                    </button>
                    <button class="export-option flex items-center gap-2.5 w-full px-3 py-2 text-xs text-slate-300 hover:bg-emerald-600/10 hover:text-emerald-300 transition-colors" data-action="export-read" data-format="md">
                        <i class="fa-brands fa-markdown text-[10px] text-emerald-400 w-4 text-center"></i> Markdown (.md)
                    </button>
                    <button class="export-option flex items-center gap-2.5 w-full px-3 py-2 text-xs text-slate-300 hover:bg-emerald-600/10 hover:text-emerald-300 transition-colors pb-2.5" data-action="export-read" data-format="csv">
                        <i class="fa-solid fa-table text-[10px] text-amber-400 w-4 text-center"></i> CSV (.csv)
                    </button>
                </div>
            </div>
        </div>

        <!-- Library Nav -->
        <div class="px-4 mb-4 space-y-0.5">
            <div class="text-[11px] font-semibold text-slate-500 ml-1 mb-2 uppercase">Library</div>
            <a href="#" class="lib-nav flex items-center gap-3 px-3 py-2 rounded-lg transition-all bg-blue-600/10 text-blue-400 border border-blue-500/20" data-lib="all">
                <i class="fa-solid fa-layer-group text-xs w-4 text-center"></i>
                <span class="text-sm flex-1">All</span>
                <span class="text-[10px] font-bold bg-slate-700/50 text-slate-400 px-1.5 py-0.5 rounded-md min-w-[24px] text-center">441</span>
            </a>
            <a href="#" class="lib-nav flex items-center gap-3 px-3 py-2 text-slate-400 hover:bg-slate-800 rounded-lg transition-all border border-transparent" data-lib="new">
                <i class="fa-solid fa-bolt text-xs w-4 text-center"></i>
                <span class="text-sm flex-1">New</span>
                <span class="text-[10px] font-bold bg-blue-500/15 text-blue-400 px-1.5 py-0.5 rounded-md min-w-[24px] text-center">403</span>
            </a>
            <a href="#" class="lib-nav flex items-center gap-3 px-3 py-2 text-slate-400 hover:bg-slate-800 rounded-lg transition-all border border-transparent" data-lib="picked">
                <i class="fa-solid fa-bookmark text-xs w-4 text-center"></i>
                <span class="text-sm flex-1">Picked</span>
                <span class="text-[10px] font-bold bg-amber-500/15 text-amber-400 px-1.5 py-0.5 rounded-md min-w-[24px] text-center">7</span>
            </a>
            <a href="#" class="lib-nav flex items-center gap-3 px-3 py-2 text-slate-400 hover:bg-slate-800 rounded-lg transition-all border border-transparent" data-lib="read">
                <i class="fa-solid fa-file-lines text-xs w-4 text-center"></i>
                <span class="text-sm flex-1">Read</span>
                <span class="text-[10px] font-bold bg-emerald-500/15 text-emerald-400 px-1.5 py-0.5 rounded-md min-w-[24px] text-center">31</span>
            </a>
            <a href="#" class="lib-nav flex items-center gap-3 px-3 py-2 text-slate-400 hover:bg-slate-800 rounded-lg transition-all border border-transparent" data-lib="archived">
                <i class="fa-solid fa-box-archive text-xs w-4 text-center"></i>
                <span class="text-sm flex-1">Archived</span>
                <span class="text-[10px] font-bold bg-slate-700/50 text-slate-500 px-1.5 py-0.5 rounded-md min-w-[24px] text-center">0</span>
            </a>
        </div>

        <!-- Filters -->
        <div class="px-4 mb-4 flex-1">
            <div class="flex items-center justify-between ml-1 mr-1 mb-2">
                <label class="text-[11px] font-semibold text-slate-500 uppercase tracking-wide">Filters</label>
                <button id="btnClearAll" class="text-[10px] text-slate-600 hover:text-red-400 transition-colors hidden">
                    <i class="fa-solid fa-xmark text-[8px] mr-0.5"></i>Clear all
                </button>
            </div>

            <!-- Search Input -->
            <div class="relative mb-2.5">
                <i class="fa-solid fa-magnifying-glass text-[10px] text-slate-600 absolute left-2.5 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                <input type="text" id="masterSearch" placeholder="Add keyword filter..."
                    class="w-full bg-slate-900/80 border border-slate-700/60 rounded-lg py-2 pl-7 pr-3 text-xs text-slate-300 outline-none focus:border-blue-500/50 focus:bg-slate-900 focus:shadow-[0_0_0_3px_rgba(59,130,246,0.08)] transition-all placeholder:text-slate-600">
            </div>

            <!-- Journal Select -->
            <div class="relative mb-3">
                <i class="fa-solid fa-newspaper text-[10px] text-slate-600 absolute left-2.5 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                <select id="journalDropdown" class="w-full bg-slate-900/80 border border-slate-700/60 rounded-lg py-2 pl-7 pr-3 text-xs text-slate-400 outline-none cursor-pointer appearance-none focus:border-blue-500/50 focus:shadow-[0_0_0_3px_rgba(59,130,246,0.08)] transition-all">
                    <option value="" disabled selected>Add journal filter...</option>
                    <option value="Nature">Nature</option>
                    <option value="npj Comp">npj Comp</option>
                    <option value="Science">Science</option>
                </select>
                <i class="fa-solid fa-chevron-down text-[8px] text-slate-600 absolute right-2.5 top-1/2 -translate-y-1/2 pointer-events-none"></i>
            </div>

            <!-- Active Filter Chips -->
            <div id="chipSection" class="hidden">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-[10px] text-slate-600 font-medium"><span id="chipCount">0</span> active</span>
                    <!-- AND / OR Toggle -->
                    <div id="logicToggle" class="flex items-center bg-slate-900 rounded-md p-0.5 border border-slate-700/40">
                        <button class="logic-btn text-[9px] font-bold px-2 py-0.5 rounded transition-all bg-blue-600/20 text-blue-400" data-mode="and">AND</button>
                        <button class="logic-btn text-[9px] font-bold px-2 py-0.5 rounded transition-all text-slate-600 hover:text-slate-400" data-mode="or">OR</button>
                    </div>
                </div>
                <div class="relative">
                    <div id="chipContainer" class="flex flex-wrap gap-1.5 max-h-[88px] overflow-y-auto custom-scrollbar pr-0.5">
                    </div>
                    <!-- Scroll fade + hint -->
                    <div id="chipOverflowHint" class="hidden">
                        <div class="absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-[#111827] to-transparent pointer-events-none rounded-b"></div>
                        <div class="flex items-center justify-center pt-1.5">
                            <button id="chipScrollBtn" class="text-[9px] text-slate-500 hover:text-blue-400 transition-colors flex items-center gap-1">
                                <i class="fa-solid fa-chevron-down text-[7px] animate-bounce"></i>
                                <span id="chipOverflowCount">+0 more</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="px-5 py-4 border-t border-slate-800 text-[10px] text-slate-600">
            PaperBot v3.0.7
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative bg-[#0b0f1a]">
        <header class="border-b border-slate-800 bg-slate-900/20">
            <div class="flex items-center justify-between px-8 h-12">
                <div class="flex items-center gap-1">
                    <button class="main-tab px-4 py-2 text-sm font-semibold text-blue-400 border-b-2 border-blue-400 transition-all" data-main-tab="home">
                        <i class="fa-solid fa-house text-[11px] mr-1.5"></i>Home
                    </button>
                    <button class="main-tab px-4 py-2 text-sm font-semibold text-slate-500 hover:text-slate-300 border-b-2 border-transparent transition-all" data-main-tab="semantic">
                        <i class="fa-solid fa-diagram-project text-[11px] mr-1.5"></i>Semantic
                    </button>
                </div>
            <div class="flex items-center gap-4">
                <div class="relative">
                    <i class="fa-solid fa-magnifying-glass text-[11px] text-slate-500 absolute left-3 top-1/2 -translate-y-1/2"></i>
                    <input type="text" placeholder="Search papers..." 
                        class="bg-slate-800/60 border border-slate-700 rounded-lg py-1.5 pl-8 pr-3 text-xs text-slate-300 w-56 outline-none focus:border-blue-500 focus:bg-slate-800 transition-all placeholder:text-slate-600">
                </div>
                <button class="text-slate-400 hover:text-white transition-colors text-xl">
                    <i class="fa-solid fa-gear"></i> </button>
            </div>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">

            <!-- Paper List (Left) -->
            <div class="w-2/5 border-r border-slate-800 overflow-y-auto custom-scrollbar">
                <div class="p-3 space-y-1">

                    <!-- Paper Card (selected) -->
                    <div class="paper-card p-3.5 rounded-xl bg-blue-600/8 border border-blue-500/20 cursor-pointer transition-all">
                        <div class="flex items-start justify-between gap-2 mb-1.5">
                            <h3 class="text-sm font-semibold leading-snug line-clamp-2">Developing a complete AI-accelerated workflow for superconductor discovery</h3>
                            <span class="flex-shrink-0 text-[9px] font-bold bg-amber-500/15 text-amber-400 px-1.5 py-0.5 rounded">93%</span>
                        </div>
                        <div class="flex items-center gap-2 text-[11px] text-slate-500">
                            <span class="text-blue-400/70">npj Comp Mat</span>
                            <span>&middot;</span>
                            <span>2026-01-27</span>
                        </div>
                    </div>

                    <!-- Paper Card -->
                    <div class="paper-card p-3.5 rounded-xl hover:bg-slate-800/50 border border-transparent hover:border-slate-700/50 cursor-pointer transition-all">
                        <div class="flex items-start justify-between gap-2 mb-1.5">
                            <h3 class="text-sm font-semibold leading-snug line-clamp-2 text-slate-300">Machine-learning potential for silver sulfide</h3>
                            <span class="flex-shrink-0 text-[9px] font-bold bg-blue-500/15 text-blue-400 px-1.5 py-0.5 rounded">78%</span>
                        </div>
                        <div class="flex items-center gap-2 text-[11px] text-slate-500">
                            <span class="text-blue-400/70">Nature</span>
                            <span>&middot;</span>
                            <span>2026-01-25</span>
                        </div>
                    </div>

                    <!-- Paper Card -->
                    <div class="paper-card p-3.5 rounded-xl hover:bg-slate-800/50 border border-transparent hover:border-slate-700/50 cursor-pointer transition-all">
                        <div class="flex items-start justify-between gap-2 mb-1.5">
                            <h3 class="text-sm font-semibold leading-snug line-clamp-2 text-slate-300">Topological superconductivity in twisted bilayer graphene</h3>
                            <span class="flex-shrink-0 text-[9px] font-bold bg-blue-500/15 text-blue-400 px-1.5 py-0.5 rounded">72%</span>
                        </div>
                        <div class="flex items-center gap-2 text-[11px] text-slate-500">
                            <span class="text-blue-400/70">Science</span>
                            <span>&middot;</span>
                            <span>2026-01-22</span>
                        </div>
                    </div>

                    <!-- Paper Card (picked indicator) -->
                    <div class="paper-card p-3.5 rounded-xl hover:bg-slate-800/50 border border-transparent hover:border-slate-700/50 cursor-pointer transition-all">
                        <div class="flex items-start justify-between gap-2 mb-1.5">
                            <h3 class="text-sm font-semibold leading-snug line-clamp-2 text-slate-300">High-throughput DFT screening of ternary compounds</h3>
                            <div class="flex items-center gap-1 flex-shrink-0">
                                <i class="fa-solid fa-bookmark text-[9px] text-amber-400"></i>
                                <span class="text-[9px] font-bold bg-slate-700/60 text-slate-400 px-1.5 py-0.5 rounded">61%</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-[11px] text-slate-500">
                            <span class="text-blue-400/70">npj Comp Mat</span>
                            <span>&middot;</span>
                            <span>2026-01-20</span>
                        </div>
                    </div>

                    <!-- Paper Card -->
                    <div class="paper-card p-3.5 rounded-xl hover:bg-slate-800/50 border border-transparent hover:border-slate-700/50 cursor-pointer transition-all">
                        <div class="flex items-start justify-between gap-2 mb-1.5">
                            <h3 class="text-sm font-semibold leading-snug line-clamp-2 text-slate-300">Crystal structure prediction using evolutionary algorithms</h3>
                            <span class="flex-shrink-0 text-[9px] font-bold bg-slate-700/60 text-slate-400 px-1.5 py-0.5 rounded">45%</span>
                        </div>
                        <div class="flex items-center gap-2 text-[11px] text-slate-500">
                            <span class="text-blue-400/70">Nature</span>
                            <span>&middot;</span>
                            <span>2026-01-18</span>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Detail View (Right) -->
            <div class="w-3/5 overflow-y-auto custom-scrollbar">
                <div class="p-8">

                    <!-- Header -->
                    <div class="flex items-start justify-between gap-4 mb-5">
                        <h1 class="text-xl font-bold leading-relaxed">Developing a complete AI-accelerated workflow for superconductor discovery</h1>
                        <button class="flex-shrink-0 flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-semibold bg-amber-500/10 text-amber-400 border border-amber-500/20 hover:bg-amber-500/20 transition-all">
                            <i class="fa-solid fa-star text-xs"></i> Picked
                        </button>
                    </div>

                    <!-- Meta -->
                    <div class="flex flex-wrap items-center gap-2 mb-6">
                        <span class="bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full text-xs font-medium">npj Computational Materials</span>
                        <span class="text-slate-500 text-xs flex items-center gap-1">
                            <i class="fa-regular fa-calendar text-[10px]"></i> 2026-01-27
                        </span>
                        <span class="bg-blue-500/15 text-blue-400 text-[10px] font-bold px-2 py-0.5 rounded-full">new</span>
                        <span class="inline-flex items-center gap-1 bg-amber-500/10 text-amber-400 text-xs font-bold px-2.5 py-1 rounded-full border border-amber-500/20">
                            <i class="fa-solid fa-wand-magic-sparkles text-[9px]"></i> 93% match
                        </span>
                    </div>

                    <!-- Authors -->
                    <div class="mb-6">
                        <h2 class="text-[11px] font-semibold text-slate-500 uppercase tracking-wide mb-2">Authors</h2>
                        <p class="text-sm text-slate-400 leading-relaxed">
                            J. Kim, S. Park, H. Lee
                            <span class="text-slate-600 text-xs ml-1 cursor-pointer hover:text-slate-400 transition-colors">외 5명</span>
                        </p>
                    </div>

                    <!-- Abstract -->
                    <div class="mb-6">
                        <h2 class="text-[11px] font-semibold text-slate-500 uppercase tracking-wide mb-2">Abstract</h2>
                        <div class="bg-slate-800/30 border border-slate-700/50 rounded-xl p-4">
                            <p class="text-sm text-slate-400 leading-[1.85]">
                                We present a comprehensive AI-driven framework that integrates machine learning interatomic potentials, 
                                high-throughput density functional theory calculations, and evolutionary crystal structure prediction 
                                to systematically discover novel superconducting materials. Our workflow begins with a large-scale 
                                screening of ternary compound spaces, followed by stability analysis using CHGNet-pretrained models, 
                                and culminates in electron-phonon coupling calculations to identify promising candidates with high 
                                critical temperatures. The framework successfully identified 12 previously unreported superconductor 
                                candidates, three of which were experimentally validated...
                            </p>
                        </div>
                    </div>

                    <!-- Links -->
                    <div class="flex flex-wrap items-center gap-2 mb-6">
                        <a href="#" class="inline-flex items-center gap-1.5 px-4 py-2 rounded-lg text-xs font-medium bg-blue-600/10 text-blue-400 hover:bg-blue-600/20 transition-colors">
                            <i class="fa-solid fa-arrow-up-right-from-square text-[10px]"></i> View Full Paper
                        </a>
                        <span class="inline-flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs text-slate-500 bg-slate-800/50 border border-slate-700/50">
                            <i class="fa-solid fa-link text-[10px]"></i> DOI: <span class="font-mono text-slate-400 select-all">10.1038/s41524-026-01234-5</span>
                        </span>
                    </div>

                    <!-- AI Semantic Insight -->
                    <div class="mb-6 border border-amber-500/15 bg-amber-500/5 rounded-xl p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fa-solid fa-wand-magic-sparkles text-amber-400 text-xs"></i>
                            <h2 class="text-[11px] font-semibold text-amber-400 uppercase tracking-wide">AI Semantic Insight</h2>
                        </div>
                        <p class="text-sm text-slate-400 leading-relaxed mb-3">
                            이 논문은 사용자의 연구 관심사인 <span class="text-amber-300 font-medium">초전도체 탐색</span> 및 
                            <span class="text-amber-300 font-medium">기계학습 포텐셜</span>과 높은 연관성을 보입니다.
                        </p>
                        <div class="flex flex-wrap gap-1.5">
                            <span class="text-[10px] bg-amber-500/10 text-amber-400/80 px-2 py-0.5 rounded-full border border-amber-500/15">superconductor</span>
                            <span class="text-[10px] bg-amber-500/10 text-amber-400/80 px-2 py-0.5 rounded-full border border-amber-500/15">DFT</span>
                            <span class="text-[10px] bg-amber-500/10 text-amber-400/80 px-2 py-0.5 rounded-full border border-amber-500/15">ML potential</span>
                            <span class="text-[10px] bg-amber-500/10 text-amber-400/80 px-2 py-0.5 rounded-full border border-amber-500/15">crystal structure</span>
                        </div>
                    </div>

                    <!-- Source Info -->
                    <div class="pt-4 border-t border-slate-700/50 text-[11px] text-slate-600 flex items-center gap-4">
                        <span>Source: arxiv-rss</span>
                        <span>Collected: 2026-01-27</span>
                        <span>ID: 42</span>
                    </div>

                </div>
            </div>

        </div>

        <button onclick="toggleAI()" class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 hover:bg-blue-500 rounded-full flex items-center justify-center shadow-xl shadow-blue-900/40 transition-transform active:scale-95 z-[60]">
            <i class="fa-solid fa-robot text-xl text-white"></i>
        </button>

        <div id="aiPopup" class="ai-popup flex flex-col">
            <div class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                    <span class="font-bold text-sm text-blue-400">PaperBot AI</span>
                </div>
                <button onclick="toggleAI()" class="text-slate-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="flex-1 p-4 overflow-y-auto text-sm text-slate-300 space-y-4 custom-scrollbar">
                <div class="bg-slate-800 p-3 rounded-lg border border-slate-700 self-start max-w-[80%]">
                    안녕하세요! 읽고 계신 논문에 대해 궁금한 점이 있으신가요?
                </div>
            </div>
            <div class="p-4 border-t border-slate-700">
                <div class="relative">
                    <input type="text" placeholder="질문을 입력하세요..." class="w-full bg-slate-900 border border-slate-700 rounded-xl py-2 px-4 pr-10 text-sm focus:border-blue-500 outline-none transition-all">
                    <button class="absolute right-3 top-2 text-blue-500"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>  
        </div>
    </main>

    <script>
        // Main Tab Switching (Home / Semantic)
        const mainTabs = document.querySelectorAll('.main-tab');
        mainTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                mainTabs.forEach(t => {
                    t.classList.remove('text-blue-400', 'border-blue-400');
                    t.classList.add('text-slate-500', 'border-transparent');
                });
                tab.classList.remove('text-slate-500', 'border-transparent');
                tab.classList.add('text-blue-400', 'border-blue-400');
            });
        });

        // Export Dropdown Toggle
        const btnExport = document.getElementById('btnExport');
        const exportDropdown = document.getElementById('exportDropdown');

        btnExport.addEventListener('click', (e) => {
            e.stopPropagation();
            exportDropdown.classList.toggle('hidden');
        });

        document.addEventListener('click', () => {
            exportDropdown.classList.add('hidden');
        });

        exportDropdown.addEventListener('click', (e) => e.stopPropagation());

        document.querySelectorAll('.export-option').forEach(opt => {
            opt.addEventListener('click', () => {
                const action = opt.dataset.action;
                const format = opt.dataset.format;
                console.log(`[${action}] format: ${format}`);
                exportDropdown.classList.add('hidden');
            });
        });

        // Library Nav Switching
        const libNavs = document.querySelectorAll('.lib-nav');
        libNavs.forEach(nav => {
            nav.addEventListener('click', (e) => {
                e.preventDefault();
                libNavs.forEach(n => {
                    n.classList.remove('bg-blue-600/10', 'text-blue-400', 'border-blue-500/20');
                    n.classList.add('text-slate-400', 'border-transparent');
                });
                nav.classList.remove('text-slate-400', 'border-transparent');
                nav.classList.add('bg-blue-600/10', 'text-blue-400', 'border-blue-500/20');
            });
        });

        // AI Popup Toggle
        function toggleAI() {
            const popup = document.getElementById('aiPopup');
            popup.style.display = (popup.style.display === 'flex') ? 'none' : 'flex';
        }

        // Integrated Filter Logic
        const journalDropdown = document.getElementById('journalDropdown');
        const masterSearch = document.getElementById('masterSearch');
        const chipContainer = document.getElementById('chipContainer');

        const chipStyles = {
            journal: {
                bg: 'bg-blue-500/10',
                border: 'border-blue-500/20',
                text: 'text-blue-400',
                icon: 'fa-newspaper',
                hoverClose: 'hover:bg-blue-400 hover:text-slate-900',
            },
            keyword: {
                bg: 'bg-slate-800',
                border: 'border-slate-600/40',
                text: 'text-slate-300',
                icon: 'fa-tag',
                hoverClose: 'hover:bg-slate-400 hover:text-slate-900',
            },
        };

        function createChip(label, type) {
            const s = chipStyles[type];
            const chip = document.createElement('div');
            chip.className = `group flex items-center gap-1.5 pl-2 pr-1 py-1 rounded-md text-[10px] font-semibold border ${s.bg} ${s.border} ${s.text} transition-all`;
            chip.innerHTML = `
                <i class="fa-solid ${s.icon} text-[8px] opacity-50"></i>
                <span>${label}</span>
                <button class="ml-0.5 w-3.5 h-3.5 rounded flex items-center justify-center text-[8px] opacity-40 group-hover:opacity-100 ${s.hoverClose} transition-all">
                    <i class="fa-solid fa-xmark"></i>
                </button>`;

            chip.querySelector('button').onclick = () => {
                chip.style.transform = 'scale(0.8)';
                chip.style.opacity = '0';
                setTimeout(() => chip.remove(), 150);
            };
            chip.style.animation = 'chipIn 0.2s ease-out';
            chipContainer.appendChild(chip);
            requestAnimationFrame(() => chipContainer.scrollTo({ top: chipContainer.scrollHeight, behavior: 'smooth' }));
        }

        journalDropdown.onchange = (e) => {
            if (e.target.value) {
                createChip(e.target.value, 'journal');
                e.target.value = "";
            }
        };

        masterSearch.onkeypress = (e) => {
            if (e.key === 'Enter' && e.target.value.trim() !== "") {
                createChip(e.target.value.trim(), 'keyword');
                e.target.value = "";
            }
        };

        // Chip section visibility + count + overflow hint
        const btnClearAll = document.getElementById('btnClearAll');
        const chipSection = document.getElementById('chipSection');
        const chipCount = document.getElementById('chipCount');
        const chipOverflowHint = document.getElementById('chipOverflowHint');
        const chipOverflowCount = document.getElementById('chipOverflowCount');
        const chipScrollBtn = document.getElementById('chipScrollBtn');

        function countHiddenChips() {
            const containerRect = chipContainer.getBoundingClientRect();
            let hidden = 0;
            [...chipContainer.children].forEach(chip => {
                if (chip.offsetTop + chip.offsetHeight > chipContainer.scrollTop + chipContainer.clientHeight) hidden++;
            });
            return hidden;
        }

        function updateOverflowHint() {
            const isOverflowing = chipContainer.scrollHeight > chipContainer.clientHeight;
            const atBottom = chipContainer.scrollTop + chipContainer.clientHeight >= chipContainer.scrollHeight - 2;

            if (isOverflowing && !atBottom) {
                chipOverflowHint.classList.remove('hidden');
                const hidden = countHiddenChips();
                chipOverflowCount.textContent = `+${hidden} more`;
            } else {
                chipOverflowHint.classList.add('hidden');
            }
        }

        chipScrollBtn.addEventListener('click', () => {
            chipContainer.scrollTo({ top: chipContainer.scrollHeight, behavior: 'smooth' });
        });

        chipContainer.addEventListener('scroll', updateOverflowHint);

        function updateChipUI() {
            const count = chipContainer.children.length;
            chipSection.classList.toggle('hidden', count === 0);
            btnClearAll.classList.toggle('hidden', count === 0);
            chipCount.textContent = count;
            requestAnimationFrame(updateOverflowHint);
        }

        // Clear All (staggered animation)
        btnClearAll.addEventListener('click', () => {
            const chips = [...chipContainer.children];
            chips.forEach((chip, i) => {
                setTimeout(() => {
                    chip.style.transform = 'scale(0.8)';
                    chip.style.opacity = '0';
                }, i * 40);
            });
            setTimeout(() => {
                chipContainer.innerHTML = '';
                updateChipUI();
            }, chips.length * 40 + 150);
        });

        new MutationObserver(updateChipUI).observe(chipContainer, { childList: true });
        updateChipUI();

        // AND / OR Toggle
        let filterMode = 'and';
        const logicBtns = document.querySelectorAll('.logic-btn');
        logicBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterMode = btn.dataset.mode;
                logicBtns.forEach(b => {
                    b.classList.remove('bg-blue-600/20', 'text-blue-400');
                    b.classList.add('text-slate-600');
                });
                btn.classList.remove('text-slate-600');
                btn.classList.add('bg-blue-600/20', 'text-blue-400');
                console.log('Filter mode:', filterMode);
            });
        });
    </script>
</body>
</html>